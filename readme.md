# log

## 25-04-18

데이터베이스 쪽 서버는 갈아 엎을 생각하는게 맞음 api 처음부터 다시 짤 가능성 높음

## 25-04-25

### baseNodeId 최초 등록 시점

textOriginRegister > idsBaseAll 에서 시작 됨
searchStore에서 관리됨

# baseNode 표시는 baseNodeHighlight

# 박스 오버레이 lzTextOverlay

## 오버레이 프레임의 메타데이터 getFrameNodeMetaData

# 일단 오버레이 될 때 메타데이터는 일시적으로 하나로 통일 됨

이는 오버레이가 전체 새로고침 되기 전까지 유지 됨
오버레이 프레임에는 임시 값이 저장되고 텍스트 노드에 영구저장 되는 개념

이 코드가 들어가면 선택 된게 없을 때 선택에 의한 변화는 초기화 됨

```js
if (backgroundFrame) {
	await overlayRender();
}
```

## overlayRender 에 비효율적인 로직이 있음

루프가 3번 돔
한 텍스트를 기반으로 화면 생성을 두번 함.. > 겹친 텍스트 때문이였음 숨겨진 텍스트들은 안보이긴 하는데

> 몇개가 진짜 물리적으로 겹쳐있는걸로 확인 됨 ( 보이는 요소인데, 백그라운드보다 뒤에 있는 경우였음, 랜더링 범위에 있어서 랜더링도 되고, 속성 상에서도 보이는 문제 )
> 선택해제 할 때 1개로 줄면 다시 전체 선택 됨 > 자동 선택 온오프 할 수 있어야 함

그리고 초기 설정 시, 설정 후 선택해제 등을 하고 다시 선택해야 정상작동하는 문제가 있음
데이터플로우가 좀 ... 구림
2번 렌더링 루프 돌던 문제는 선택 변경을 일으키는 기능 실행 시 상태를 관리하고, 선택이 바로 안되던 건 선택 변경된 값을 다시 가져와서 렌더링 루프에 포함 시키는 걸로 해결함

## 베이스 노드를 변경할 수 있음

searchStore.updateBaseNode 에서 업데이트 할 수 있음
전파도 알아서 됨
변경을 위해 UI에서 선택 토글 로직 대신에 다음 베이스 노드를 선택하는 기능을 넣었음

다중 선택은 기본적으로 베이스노드를 기반으로 선택 확장을 하겠다 라는 로직임

## 섹션 선택 시 해야할 것 2가지 + a임

1. 적용 범위 선택
2. 기준 노드 선택
3. (선택) 이름 결정

# 키 추가 순서

1. 도메인 추가 ( 초기 설정 )
2. 섹션 추가 ( 선택 ) : 아직 추가 안됨
3. 로컬라이제이션 키 ( 임시 키 생성 ) : textKeyRegister
4. 리소스 추가 ( 자동 ) : ... styleToXml 과정에 등록 됨
5. 로컬라이제이션 텍스트 추가 ( 자동 ) ( 텍스트 형태는 `<b>xxx</b>`) : addTranslation 과정에 추가
   5-1. 스타일로 세그먼트 쪼개고 순서에 따라 자동으로 액션 부여 : src/domain/Style/Tags.tsx 에서 UI로 처리했었음
6. 피그마 위치 추가 ( 자동 ) : setNodeLocation
7. 로컬라이제이션 키액션 추가 로컬라이제이션 키 + ( 리소스(12:34)랑 식별자(enum) , 액션(default) 묶어서 매핑 ) : 원래 (5-1)
   1. 리소스 아이디 필수(4)
   2. 키 필수 (3)
8. 피그마 위치 > 키액션 매핑
   1. 피그마 위치(6)
   2. 키 + 액션 + 식별자 를 유니크 키로 등록하는데 ... 식별자는 세그먼트 단위여서 액션부터 위치 값이 고유함

4,5,7,8 을 언제 실행할 거고
8에 도달하지 못한 키를 어떻게 삭제할 건가

## 최소 addTranslation 에서 시작

### FIGMA_LOCATION_KEY_ACTIONS 기반으로 연결되지 않은 키 삭제

FIGMA_LOCATION_KEY_ACTIONS 에서 연결되지 않은 것은 완결되지 않은 키로 판단해서 전체 삭제
소유권을 가져오는 개념으로 변경 지원하면 문제 될 것 없음

내부 시스템이 아니라 외부 api 로 전체 삭제

## 이에 따라 연결 없는 대상 식별 후 삭제 가능성이 생김

그리고 자동 식별이 아니라 추가 된 대상만 식별하게 할 수 있어야 함
정상적으로 작업된 대상을 식별하기 위해 필요함

## 키로 노출 되는 대상

1. 같은 섹션에 같은 텍스트를 가진 서버에 등록 된 키
2. 기존에 이미 부여 되어 있는 피그마에 등록 된 키
3. 새로 랜덤 생성된 AI 또는 랜덤 생성 된 키

# 등록 된 키가 유효한 지 검사하지 않는 문제가 있음

피그마에 저장되있는 아이디가 실제로 등록되있는지 확인하지 않음

# 최소 메인에서 실행되는 Fetch 코드들은 emit 으로 실패에 대한 메시지를 보내야 함

ㅇㅇ.. 특히 서버 문제 있는데 뭐가 문제인지 안보이는 건 문제임
